name: api-evolution
display_name: "API Evolution"
category: coordination
description: "Manages API versioning, backwards compatibility, and evolution strategies"

coordination_patterns:
  - name: "api_versioning_strategy"
    trigger: "when designing or modifying APIs"
    action: "coordinate API versioning and backwards compatibility with backend agents"
    context_required: ["existing_api_contracts", "breaking_changes", "client_dependencies"]

  - name: "api_deprecation_management"
    trigger: "when deprecating API endpoints or features"
    action: "manage deprecation timeline and client migration strategy"
    context_required: ["deprecation_timeline", "migration_path", "client_impact"]

implementation: |
  ## API Evolution Coordination

  **APIs are contracts - evolve them responsibly with clear communication**

  ### API Versioning Strategies
  1. **Versioning Approaches**:
     - **URL Path Versioning**: `/api/v1/users`, `/api/v2/users`
     - **Header Versioning**: `Accept: application/vnd.api+json;version=1`
     - **Query Parameter**: `/api/users?version=1`
     - **Content Negotiation**: Media type versioning

  2. **Backwards Compatibility**:
     - **Additive Changes**: New fields, endpoints (non-breaking)
     - **Modification Changes**: Field type changes (potentially breaking)
     - **Removal Changes**: Deprecated endpoints, fields (breaking)
     - **Behavioral Changes**: Logic changes (potentially breaking)

  ### API Evolution Workflow
  ```
  API Evolution Pipeline:
  backend-engineer → Design API changes with versioning
  ↓
  API Documentation → Update OpenAPI specs and documentation
  ↓
  Client Coordination → Communicate changes to API consumers
  ↓
  Migration Support → Provide migration tools and support
  ↓
  Deprecation Management → Gradual sunset of old versions
  ```

  ### Change Management Process
  1. **Impact Assessment**:
     - Identify all API consumers and their usage patterns
     - Assess breaking change impact and migration effort
     - Plan rollout strategy and communication timeline
     - Prepare migration documentation and tools

  2. **Deprecation Strategy**:
     - Announce deprecation with sufficient notice (6-12 months)
     - Provide clear migration path and documentation
     - Monitor API usage and support client migrations
     - Gradually reduce support and finally remove deprecated versions

  ### API Design Principles
  - **Design for Evolution**: Plan for future changes from the start
  - **Consistent Patterns**: Use consistent naming and structure conventions
  - **Comprehensive Documentation**: OpenAPI specs, examples, migration guides
  - **Client SDK Support**: Maintain SDKs and client libraries
  - **Monitoring and Analytics**: Track API usage and performance

  ### Breaking Change Examples
  ```json
  // Breaking: Changing field type
  // v1: {"user_id": "123"}
  // v2: {"user_id": 123}

  // Non-breaking: Adding optional field
  // v1: {"name": "John"}
  // v1.1: {"name": "John", "email": "john@example.com"}
  ```

  ### Coordination Examples
  - "API versioning strategy established - using semantic versioning"
  - "Breaking change identified - planning v2 migration path"
  - "Deprecation notice sent - v1 endpoints sunset in 6 months"
  - "Client migration completed - 95% traffic moved to v2"